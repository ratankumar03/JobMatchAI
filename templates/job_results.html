{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Job Matches - JobMatchAI{% endblock %}

{% block content %}
<div class="results-section">
    <div class="container">
        <div class="results-header">
            <h1><i class="fas fa-briefcase"></i> Your Job Matches</h1>
            <p>Found {{ total_jobs }} verified opportunities matching your profile</p>
        </div>

        <div class="results-stats">
            <div class="stat-card">
                <i class="fas fa-check-circle"></i>
                <div>
                    <h3>{{ total_jobs }}</h3>
                    <p>Total Matches</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-shield-alt"></i>
                <div>
                    <h3>100%</h3>
                    <p>Verified Links</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-globe"></i>
                <div>
                    <h3>{{ job_listings|length }}</h3>
                    <p>Job Portals</p>
                </div>
            </div>
        </div>

        {% if matching_results.suitable_job_titles %}
        <div class="recommendations-card">
            <h3><i class="fas fa-star"></i> Recommended Job Titles for You</h3>
            <div class="job-titles-list">
                {% for title in matching_results.suitable_job_titles %}
                <span class="job-title-tag">{{ title }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Official Government Job Portals Section -->
        {% if government_jobs %}
        <div class="job-section">
            <h2 class="section-header"><i class="fas fa-landmark"></i> Official Government Job Portals</h2>
            <div class="jobs-container">
                {% for job in government_jobs %}
                <div class="job-card">
                    <div class="job-header">
                        <div class="job-icon government-icon">
                            <i class="fas fa-landmark"></i>
                        </div>
                        <div class="job-info">
                            <h3>{{ job.title }}</h3>
                            <p class="job-company">
                                <i class="fas fa-building"></i> {{ job.company }}
                            </p>
                        </div>
                        <div class="verified-badge">
                            <i class="fas fa-check-circle"></i> Verified
                        </div>
                    </div>

                    <div class="job-details">
                        <div class="job-detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ job.location }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>{{ job.posted_date }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-globe"></i>
                            <span>{{ job.source }}</span>
                        </div>
                    </div>

                    <div class="job-description">
                        <p>{{ job.description }}</p>
                    </div>

                    <div class="job-actions">
                        <a href="{{ job.link }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                            <i class="fas fa-external-link-alt"></i> View Job & Apply
                        </a>
                        <button class="btn btn-secondary btn-copy" data-link="{{ job.link }}">
                            <i class="fas fa-copy"></i> Copy Link
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- General Job Boards Section -->
        {% if general_jobs %}
        <div class="job-section">
            <h2 class="section-header"><i class="fas fa-search"></i> General Job Boards</h2>
            <div class="jobs-container">
                {% for job in general_jobs %}
                <div class="job-card">
                    <div class="job-header">
                        <div class="job-icon general-icon">
                            {% if 'LinkedIn' in job.source %}
                            <i class="fab fa-linkedin"></i>
                            {% elif 'Indeed' in job.source %}
                            <i class="fas fa-search"></i>
                            {% elif 'Glassdoor' in job.source %}
                            <i class="fas fa-star"></i>
                            {% else %}
                            <i class="fas fa-briefcase"></i>
                            {% endif %}
                        </div>
                        <div class="job-info">
                            <h3>{{ job.title }}</h3>
                            <p class="job-company">
                                <i class="fas fa-building"></i> {{ job.company }}
                            </p>
                        </div>
                        <div class="verified-badge">
                            <i class="fas fa-check-circle"></i> Verified
                        </div>
                    </div>

                    <div class="job-details">
                        <div class="job-detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ job.location }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>{{ job.posted_date }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-globe"></i>
                            <span>{{ job.source }}</span>
                        </div>
                    </div>

                    <div class="job-description">
                        <p>{{ job.description }}</p>
                    </div>

                    <div class="job-actions">
                        <a href="{{ job.link }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                            <i class="fas fa-external-link-alt"></i> View Job & Apply
                        </a>
                        <button class="btn btn-secondary btn-copy" data-link="{{ job.link }}">
                            <i class="fas fa-copy"></i> Copy Link
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Major Company Career Pages Section -->
        {% if company_jobs %}
        <div class="job-section">
            <h2 class="section-header"><i class="fas fa-building"></i> Major Company Career Pages</h2>
            <div class="jobs-container">
                {% for job in company_jobs %}
                <div class="job-card">
                    <div class="job-header">
                        <div class="job-icon company-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="job-info">
                            <h3>{{ job.title }}</h3>
                            <p class="job-company">
                                <i class="fas fa-building"></i> {{ job.company }}
                            </p>
                        </div>
                        <div class="verified-badge">
                            <i class="fas fa-check-circle"></i> Verified
                        </div>
                    </div>

                    <div class="job-details">
                        <div class="job-detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ job.location }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>{{ job.posted_date }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-globe"></i>
                            <span>{{ job.source }}</span>
                        </div>
                    </div>

                    <div class="job-description">
                        <p>{{ job.description }}</p>
                    </div>

                    <div class="job-actions">
                        <a href="{{ job.link }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                            <i class="fas fa-external-link-alt"></i> View Job & Apply
                        </a>
                        <button class="btn btn-secondary btn-copy" data-link="{{ job.link }}">
                            <i class="fas fa-copy"></i> Copy Link
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Specialized Job Boards Section -->
        {% if specialized_jobs %}
        <div class="job-section">
            <h2 class="section-header"><i class="fas fa-rocket"></i> Specialized Job Boards</h2>
            <div class="jobs-container">
                {% for job in specialized_jobs %}
                <div class="job-card">
                    <div class="job-header">
                        <div class="job-icon specialized-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div class="job-info">
                            <h3>{{ job.title }}</h3>
                            <p class="job-company">
                                <i class="fas fa-building"></i> {{ job.company }}
                            </p>
                        </div>
                        <div class="verified-badge">
                            <i class="fas fa-check-circle"></i> Verified
                        </div>
                    </div>

                    <div class="job-details">
                        <div class="job-detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ job.location }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>{{ job.posted_date }}</span>
                        </div>
                        <div class="job-detail-item">
                            <i class="fas fa-globe"></i>
                            <span>{{ job.source }}</span>
                        </div>
                    </div>

                    <div class="job-description">
                        <p>{{ job.description }}</p>
                    </div>

                    <div class="job-actions">
                        <a href="{{ job.link }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                            <i class="fas fa-external-link-alt"></i> View Job & Apply
                        </a>
                        <button class="btn btn-secondary btn-copy" data-link="{{ job.link }}">
                            <i class="fas fa-copy"></i> Copy Link
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="results-actions">
            <a href="{% url 'chatbot' %}" class="btn btn-primary btn-large">
                <i class="fas fa-robot"></i> Ask AI Assistant
            </a>
            <a href="{% url 'job_preferences' %}" class="btn btn-secondary btn-large">
                <i class="fas fa-redo"></i> Refine Search
            </a>
            <a href="{% url 'reset_session' %}" class="btn btn-outline btn-large">
                <i class="fas fa-home"></i> Start New Search
            </a>
        </div>

        <div class="safety-notice">
            <i class="fas fa-shield-alt"></i>
            <div>
                <h4>All Links Are Verified & Official</h4>
                <p>Every job link comes from trusted sources including official government portals (UK Civil Service, USAJOBS, NCS India, etc.), major job boards (LinkedIn, Indeed, Glassdoor), and official company career pages. We never provide fake or unverified links.</p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Copy link functionality
    const copyButtons = document.querySelectorAll('.btn-copy');
    
    copyButtons.forEach(button => {
        button.addEventListener('click', function() {
            const link = this.getAttribute('data-link');
            
            navigator.clipboard.writeText(link).then(() => {
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-check"></i> Copied!';
                this.classList.add('success');
                
                setTimeout(() => {
                    this.innerHTML = originalHTML;
                    this.classList.remove('success');
                }, 2000);
            }).catch(() => {
                alert('Failed to copy link. Please try again.');
            });
        });
    });
});
</script>
{% endblock %}